import{S as u}from"./SectionRenderer-13647958.js";import{S as m,A as y}from"./ast-ed384815.js";import{_ as v,r as d,c as _,j as I,l as w,a as g,g as S,d as F,o as f,v as K}from"./index-8cbd1e78.js";import"./compiler-73655abd.js";const b={props:["doc"],inject:["io","fs","account","packer","compiler","broadcaster"],components:{SectionRenderer:u,SectionFiles:m},data:()=>({loaded:!1,renderKey:0,fsItem:null,ast:new y}),watch:{"account.main"(t){this.ast.parse(t)},async"account.filepath"(t){var a;if(t===((a=this.fsItem)==null?void 0:a.path))return;let e=this.account.filepath.split("/");try{let s=await this.fs.stat(this.account.filepath);this.fsItem={title:e[e.length-1],path:this.account.filepath,...s}}catch{this.fsItem=null}},async fsItem(t,e){if(t!=null&&t.path.endsWith(".vue")){this.account.filepath=t.path;try{this.account.main=await this.fs.readFile(t.path,{encoding:"utf8"}),e||(this.layers="component")}catch{this.account.main=""}}}},async created(){var t,e;if(this.broadcaster.onmessage=async a=>{var s,h,c,o,r,i,n,l;if(!((s=a.data)!=null&&s.id)!==((o=(c=(h=this.account)==null?void 0:h.project)==null?void 0:c.data)==null?void 0:o._id))if(a.data.reload&&await this.reload(),(r=this.fsItem)!=null&&r.path.endsWith(".vue")&&((i=this.fsItem)==null?void 0:i.path)===((n=a.data)==null?void 0:n.path))try{this.account.main=await this.fs.readFile(this.fsItem.path,{encoding:"utf8"})}catch(p){console.log(p)}else(l=a.data)!=null&&l.path&&await this.reload()},this.account.filepath&&((t=this.account)==null?void 0:t.filepath)!==((e=this.fsItem)==null?void 0:e.path)){let a=this.account.filepath.split("/");try{let s=await this.fs.stat(this.account.filepath);this.fsItem={title:a[a.length-1],path:this.account.filepath,...s}}catch{this.fsItem=null}}},async mounted(){this.ast.parse(this.account.main)},methods:{async reload(){var t;try{await this.fs.stat((t=this.fsItem)==null?void 0:t.path),this.account.main=await this.fs.readFile(this.fsItem.path,{encoding:"utf8"}),this.ast.parse(this.account.main)}catch{}this.renderKey++}}},k={class:"preview"};function B(t,e,a,s,h,c){var i;const o=d("SectionRenderer"),r=d("SectionFiles");return f(),_("div",k,[I(o,{path:(i=t.fsItem)==null?void 0:i.path,ast:t.ast.root,main:c.account.main,sidemenu:"0px",mobile:!1,events:!0,full:!0,renderKey:t.renderKey,onInit:e[0]||(e[0]=n=>t.renderKey++)},null,8,["path","ast","main","renderKey"]),w(g("div",null,[t.loaded?F("",!0):(f(),S(r,{key:0,selected:t.fsItem,onSelected:e[1]||(e[1]=n=>(t.fsItem=n,t.loaded=!0))},null,8,["selected"]))],512),[[K,!1]])])}const P=v(b,[["render",B],["__scopeId","data-v-c4c1bef3"]]);export{P as default};
